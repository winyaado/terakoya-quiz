# 寺子屋クイズ道場 (Terakoya Quiz Dojo)

ようこそ！寺子屋クイズ道場へ！これはブラウザベースのクイズアプリケーションで、ユーザーはクイズに挑戦したり、オリジナルの問題束をインポートしたり、成績を記録・管理したりすることができます。

## 主な機能

* **クイズ実行**:
    * 選択した問題束からクイズに挑戦できます。
    * 各問題には制限時間が設定されており、タイマーバーで残り時間が視覚的に表示されます。
    * 解答後すぐに正誤フィードバックと解説（あれば）が表示されます。
    * クイズ終了後にはスコアと最終メッセージが表示されます。
* **問題束管理**:
    * `.tkquiz` 形式（Base64エンコードされたCSV）のファイルをインポートして新しい問題束を追加できます。
    * CSVファイルの形式: `問題文,選択肢1,選択肢2,選択肢3,選択肢4,正答,解説` (7列)。
    * デフォルトで「基本問題」が用意されています。
    * インポートした問題束は削除可能です（「基本問題」は削除不可）。
* **稽古設定**:
    * 1回のクイズで出題される問題数を設定できます（デフォルト20問、1問以上）。
    * 問題ごとの制限時間を秒単位で設定できます（デフォルト30秒、1秒以上）。
    * 設定はブラウザのlocalStorageに保存されます。
* **成績確認**:
    * 問題ごとの正解数、誤答数、出題数、正解率が記録・表示されます。
    * 解答履歴は `.tkstats` 形式（Base64エンコードされたJSON）でエクスポートできます。
    * `.tkstats` ファイルをインポートして解答履歴を復元できます。
    * 解答履歴全体をリセットする機能があります。
    * 成績データもブラウザのlocalStorageに保存されます。
* **問題選択ロジック**:
    * クイズ開始時、未解答の問題、正答率の低い問題が優先的に出題されるようになっています。

## 画面構成

本アプリケーションはタブベースのインターフェースを採用しています。

1.  **クイズ開始 (Start Quiz)**
    * 挑戦する問題束を選択します。
    * 選択中の問題束に含まれる問題数が表示されます。
    * 現在の設定（問題数、制限時間）が表示されます。
    * 「稽古開始」ボタンでクイズを開始します。
    * 選択した問題束を削除するボタンがあります（基本問題を除く）。

2.  **問題束インポート (Import Quiz Set)**
    * `.tkquiz` 形式のファイルを選択して、新しい問題束をインポートします。
    * ファイル形式はBase64エンコードされたUTF-8のCSVです。
    * CSVの各行は `問題,回答1,回答2,回答3,回答4,正答,解説` の7列で構成されている必要があります。
    * インポートされた問題束名はファイル名（拡張子を除く）になります。
    * 「基本問題」という名前のファイルはインポートできません。

3.  **稽古設定 (Practice Settings)**
    * 「1回の問題数」と「問題ごとの制限時間（秒）」を設定し、保存できます。

4.  **成績確認 (Check Performance)**
    * 問題の正答（キー）ごとに、正解数、誤答数、総出題数、正解率が表形式で表示されます。
    * 「解答履歴をエクスポート」ボタンで、現在の成績データを `.tkstats` ファイルとしてダウンロードできます。
    * `.tkstats` ファイルを選択し、「解答履歴をインポート」ボタンで成績データを読み込めます。
    * 「解答履歴をリセット」ボタンで、保存されている全ての成績データを消去できます。

## ファイル形式

* **問題束ファイル (`.tkquiz`)**:
    * 実体はBase64エンコードされたCSVファイルです。
    * CSVの文字コードはUTF-8です。
    * 各行のフォーマット: `問題文,選択肢1,選択肢2,選択肢3,選択肢4,正答文字列,解説文`
        * 例: `日本の首都はどこですか？,大阪,京都,東京,名古屋,東京,日本の首都は東京です。`
* **解答履歴ファイル (`.tkstats`)**:
    * 実体はBase64エンコードされたJSONファイルです。
    * JSONオブジェクトのキーは問題の「正答文字列」で、値は `{ questionText: "問題文", correct: 正解数, incorrect: 誤答数, total: 出題数 }` という形式のオブジェクトです。

## 使用方法

1.  HTMLファイル (`terakoya-quiz.html`) をブラウザで開きます。
2.  **クイズ開始タブ**:
    * 「挑戦する問題束」ドロップダウンから問題セットを選択します。
    * 「稽古開始」ボタンをクリックしてクイズを開始します。
3.  **問題束インポートタブ**:
    * 「ファイルを選択」ボタンで `.tkquiz` ファイルを選びます。
    * 「インポート実行」ボタンをクリックします。
4.  **稽古設定タブ**:
    * 問題数や制限時間を変更し、「設定を保存」ボタンをクリックします。
5.  **成績確認タブ**:
    * 過去の解答履歴を確認できます。
    * 必要に応じて、履歴のエクスポート、インポート、リセットを行います。

## 技術詳細

* **フロントエンド**: HTML, CSS (Tailwind CSS), JavaScript (ES Modules)
* **データ永続化**: ブラウザの `localStorage` を使用して、稽古設定、インポートされた問題束、および解答履歴を保存します。

## 注意事項

* 「基本問題」という名前の問題束はインポートできません。これはシステム予約名です。
* インポートするファイルの文字エンコーディングはUTF-8を想定しています。
* CSVの区切り文字はカンマ (`,`) です。